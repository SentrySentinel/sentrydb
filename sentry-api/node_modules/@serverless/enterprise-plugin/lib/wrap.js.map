{"version":3,"sources":["../../lib/wrap.js"],"names":["fs","require","path","_","JSZip","addTree","writeZip","wrapNodeJs","fn","ctx","newHandlerCode","sls","service","tenant","app","appUid","tenantUid","deploymentUid","provider","getStage","name","timeout","entryOrig","handlerOrig","writeFileSync","join","config","servicePath","entryNew","wrapPython","wrap","cli","log","functions","state","Object","keys","func","runtime","includes","stage","entry","handler","split","extension","key","replace","handlerNew","pathAssets","pathExistsSync","removeSync","ensureDirSync","vals","map","some","pathSdk","resolve","__dirname","pathSdkDest","copySync","get","zipData","readFile","package","artifact","zip","loadAsync","wrapperData","file","undefined","include","push","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\n/*\n * Wrap\n * - Bundles the ServerlessSDK into your functions\n * - Wraps your function handlers with the ServerlessSDK\n */\n\nconst fs = require('fs-extra');\nconst path = require('path');\nconst _ = require('lodash');\nconst JSZip = require('jszip');\nconst { addTree, writeZip } = require('./zipTree');\n\n/*\n * Wrap Node.js Functions\n */\nconst wrapNodeJs = (fn, ctx) => {\n  const newHandlerCode = `var serverlessSDK = require('./serverless_sdk/index.js')\nserverlessSDK = new serverlessSDK({\ntenantId: '${ctx.sls.service.tenant}',\napplicationName: '${ctx.sls.service.app}',\nappUid: '${ctx.sls.service.appUid}',\ntenantUid: '${ctx.sls.service.tenantUid}',\ndeploymentUid: '${ctx.deploymentUid}',\nserviceName: '${ctx.sls.service.service}',\nstageName: '${ctx.provider.getStage()}'})\nconst handlerWrapperArgs = { functionName: '${fn.name}', timeout: ${fn.timeout}}\ntry {\n  const userHandler = require('./${fn.entryOrig}.js')\n  module.exports.handler = serverlessSDK.handler(userHandler.${fn.handlerOrig}, handlerWrapperArgs)\n} catch (error) {\n  module.exports.handler = serverlessSDK.handler(() => { throw error }, handlerWrapperArgs)\n}\n`;\n\n  // Create new handlers\n  fs.writeFileSync(path.join(ctx.sls.config.servicePath, `${fn.entryNew}.js`), newHandlerCode);\n};\n\n/*\n * Wrap python Functions\n */\nconst wrapPython = (fn, ctx) => {\n  const newHandlerCode = `import serverless_sdk\nsdk = serverless_sdk.SDK(\n    tenant_id='${ctx.sls.service.tenant}',\n    application_name='${ctx.sls.service.app}',\n    app_uid='${ctx.sls.service.appUid}',\n    tenant_uid='${ctx.sls.service.tenantUid}',\n    deployment_uid='${ctx.deploymentUid}',\n    service_name='${ctx.sls.service.service}',\n    stage_name='${ctx.provider.getStage()}'\n)\nhandler_wrapper_kwargs = {'function_name': '${fn.name}', 'timeout': ${fn.timeout}}\ntry:\n    user_handler = serverless_sdk.get_user_handler('${fn.entryOrig}.${fn.handlerOrig}')\n    handler = sdk.handler(user_handler, **handler_wrapper_kwargs)\nexcept Exception as error:\n    e = error\n    def error_handler(event, context):\n        raise e\n    handler = sdk.handler(error_handler, **handler_wrapper_kwargs)\n`;\n\n  // Create new handlers\n  fs.writeFileSync(path.join(ctx.sls.config.servicePath, `${fn.entryNew}.py`), newHandlerCode);\n};\n\nconst wrap = async ctx => {\n  // Check if we support the provider\n  if (ctx.sls.service.provider.name !== 'aws') {\n    ctx.sls.cli.log(\n      'Warning: The Serverless Platform Plugin does not current support this provider.'\n    );\n  }\n\n  /*\n   * Prepare Functions\n   */\n  const { functions } = ctx.sls.service;\n  ctx.state.functions = {};\n  for (const func of Object.keys(functions)) {\n    const runtime = functions[func].runtime\n      ? functions[func].runtime\n      : ctx.sls.service.provider.runtime;\n    if (!runtime.includes('nodejs') && !runtime.includes('python')) {\n      continue;\n    }\n\n    // the default is 6s: https://serverless.com/framework/docs/providers/aws/guide/serverless.yml/\n    const timeout = functions[func].timeout ? functions[func].timeout : 6;\n\n    // Process name\n    let name;\n    if (functions[func].name) {\n      ({ name } = functions[func]);\n    } else {\n      name = `${ctx.sls.service.service}-${ctx.sls.service.provider.stage}-${func}`;\n    }\n\n    // Process handler\n    const entry = functions[func].handler.split('.')[0];\n    const handler = functions[func].handler.split('.')[1];\n\n    let extension = 'js';\n    if (runtime.includes('python')) {\n      extension = 'py';\n    }\n\n    ctx.state.functions[func] = {\n      key: func,\n      name,\n      runtime,\n      timeout,\n      extension,\n      entryOrig: entry,\n      handlerOrig: handler,\n      entryNew: `s_${func.replace(/-/g, '_')}`,\n      handlerNew: 'handler',\n    };\n  }\n\n  /*\n   * Wrap Functions\n   */\n\n  ctx.state.pathAssets = path.join(ctx.sls.config.servicePath, 'serverless_sdk');\n\n  // Clear existing handler dir\n  if (fs.pathExistsSync(ctx.state.pathAssets)) {\n    fs.removeSync(ctx.state.pathAssets);\n  }\n\n  // Create new handler dir\n  fs.ensureDirSync(ctx.state.pathAssets);\n\n  // Copy SDK\n  const vals = Object.keys(ctx.state.functions).map(key => ctx.state.functions[key]);\n  if (vals.some(({ runtime }) => runtime.includes('nodejs'))) {\n    const pathSdk = path.resolve(__dirname, '../sdk-js/dist/index.js');\n    const pathSdkDest = path.join(ctx.state.pathAssets, './index.js');\n    fs.copySync(pathSdk, pathSdkDest);\n  }\n  if (vals.some(({ runtime }) => runtime.includes('python'))) {\n    const pathSdk = path.resolve(__dirname, '../sdk-py/serverless_sdk.py');\n    const pathSdkDest = path.join(ctx.state.pathAssets, './__init__.py');\n    fs.copySync(pathSdk, pathSdkDest);\n  }\n\n  // Prepare & Copy Function Handlers\n  for (const fn of Object.keys(ctx.state.functions)) {\n    const func = ctx.state.functions[fn];\n\n    if (!func.runtime.includes('nodejs') && !func.runtime.includes('python')) {\n      continue;\n    }\n\n    // Add the Serverless SDK wrapper around the function\n\n    if (func.runtime.includes('nodejs')) {\n      wrapNodeJs(func, ctx);\n    } else if (func.runtime.includes('python')) {\n      wrapPython(func, ctx);\n    }\n\n    // Re-assign the handler to point to the wrapper\n    ctx.sls.service.functions[fn].handler = `${func.entryNew}.${func.handlerNew}`;\n\n    if (_.get(ctx.sls.service.functions[fn], 'package.artifact')) {\n      const zipData = await fs.readFile(ctx.sls.service.functions[fn].package.artifact);\n      const zip = await JSZip.loadAsync(zipData);\n      const wrapperData = await fs.readFile(\n        path.join(ctx.sls.config.servicePath, `${func.entryNew}.${func.extension}`)\n      );\n      zip.file(`${func.entryNew}.${func.extension}`, wrapperData);\n      await addTree(zip, 'serverless_sdk');\n      await writeZip(zip, ctx.sls.service.functions[fn].package.artifact);\n    } else if (\n      _.get(\n        ctx.sls.service.functions[fn],\n        'package.individually',\n        _.get(ctx.sls.service, 'package.individually', false)\n      )\n    ) {\n      // add include directives for handler file & sdk lib\n      if (ctx.sls.service.functions[fn].package === undefined) {\n        ctx.sls.service.functions[fn].package = {};\n      }\n      if (ctx.sls.service.functions[fn].package.include === undefined) {\n        ctx.sls.service.functions[fn].package.include = [];\n      }\n      ctx.sls.service.functions[fn].package.include.push(`${func.entryNew}.${func.extension}`);\n      ctx.sls.service.functions[fn].package.include.push('serverless_sdk/**');\n    }\n  }\n\n  // add include directives for handler file & sdk lib\n  if (!_.get(ctx.sls.service, 'package.individually', false)) {\n    let extension = 'js';\n    if (ctx.sls.service.provider.runtime.includes('python')) {\n      extension = 'py';\n    }\n    if (ctx.sls.service.package === undefined) {\n      ctx.sls.service.package = {};\n    }\n    if (ctx.sls.service.package.include === undefined) {\n      ctx.sls.service.package.include = [];\n    }\n    ctx.sls.service.package.include.push(`s_*.${extension}`);\n    ctx.sls.service.package.include.push('serverless_sdk/**');\n  }\n};\n\nmodule.exports = wrap;\n"],"file":"wrap.js"}